# Kullanıcı listesinin bulunduğu dosya(belirtilen adrese  bir txt oluşturun)

# içine sadece sAMAccountName alt alta yazın

$Users = Get-Content "C:\scripts\userdisable.txt"



# Yeni yönetici (Manager) bilgisi değiştirmek için ilgili alan

$ManagerDN = "CN=Emrah TOLU OU=YONETICI_HESAPLARI,OU=ETKIN_HESAPLAR,DC=tolu,DC=local"



# Yeni OU bilgisi 

$NewOU = "OU=ISTEN_AYRILANLAR,OU=FINANS,DC=tolu,DC=local"



# Kullanıcıları işleme al

foreach ($User in $Users) {

  $ADUser = Get-ADUser -Identity $User -ErrorAction SilentlyContinue



  if ($ADUser) {

    Write-Host "İşlem başlıyor: $User" -ForegroundColor Cyan



    # 1. Kullanıcının "Manager" alanını güncelle

    # boş bırakmak için Set-ADUser -Identity $User -Clear **Manager**

    # alttaki alan ile değiştiriniz.

    Set-ADUser -Identity $User -Manager $ManagerDN

    Write-Host " - Manager güncellendi: $ManagerDN" -ForegroundColor Green



    # 2. Kullanıcıyı "Domain Users" hariç tüm gruplardan çıkar

    $Groups = Get-ADUser $User -Property MemberOf | Select-Object -ExpandProperty MemberOf

    foreach ($Group in $Groups) {

      if ($Group -notmatch "CN=Domain Users,") {

        Remove-ADGroupMember -Identity $Group -Members $User -Confirm:$false

        Write-Host " - Çıkarıldı: $Group" -ForegroundColor Green

      }

    }



    # 3. Kullanıcıyı yeni OU'ya taşı

    Move-ADObject -Identity $ADUser.DistinguishedName -TargetPath $NewOU

    Write-Host " - Kullanıcı taşındı: $NewOU" -ForegroundColor Green



    # 4. Kullanıcıyı devre dışı bırak

    Disable-ADAccount -Identity $User

    Write-Host " - Kullanıcı devre dışı bırakıldı." -ForegroundColor Yellow

  } else {

    Write-Host "HATA: Kullanıcı bulunamadı - $User" -ForegroundColor Red

  }

}



Write-Host "Tüm işlemler tamamlandı." -ForegroundColor Magenta
